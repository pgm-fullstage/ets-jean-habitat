---
import Button from "../Button.astro";

const siteData = Astro.props.siteData || (typeof window !== 'undefined' ? window.siteData : null);

if (!siteData) {
  throw new Error('siteData is required for HowItWorks component');
}

const { business, ui_sections,cities } = siteData;
const { theme, how_it_works } = ui_sections;
const currentCity = cities?.default || 'louannec';
const cityData = cities?.available?.[currentCity] || {
  hero_title: "Buscail Habitat Couverture à Louannec",
  hero_description: "Expert en couverture, isolation et rénovation à Louannec. Nous garantissons des travaux de qualité pour protéger votre habitat durablement."
};
// Fonction pour obtenir l'icône SVG appropriée
const getIcon = (iconName) => {
  const icons = {
    phone: `<path d="M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 0 0 6.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 0 1 1.767-1.052l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 0 1 2.43 8.326 13.019 13.019 0 0 1 2 5V3.5Z" clip-rule="evenodd" fill-rule="evenodd" />`,
    calculator: `<path d="m7.171 4.146 1.947 2.466a3.514 3.514 0 0 1 1.764 0l1.947-2.466a6.52 6.52 0 0 0-5.658 0Zm8.683 3.025-2.466 1.947c.15.578.15 1.186 0 1.764l2.466 1.947a6.52 6.52 0 0 0 0-5.658Zm-3.025 8.683-1.947-2.466c-.578.15-1.186.15-1.764 0l-1.947 2.466a6.52 6.52 0 0 0 5.658 0ZM4.146 12.83l2.466-1.947a3.514 3.514 0 0 1 0-1.764L4.146 7.171a6.52 6.52 0 0 0 0 5.658ZM5.63 3.297a8.01 8.01 0 0 1 8.738 0 8.031 8.031 0 0 1 2.334 2.334 8.01 8.01 0 0 1 0 8.738 8.033 8.033 0 0 1-2.334 2.334 8.01 8.01 0 0 1-8.738 0 8.032 8.032 0 0 1-2.334-2.334 8.01 8.01 0 0 1 0-8.738A8.03 8.03 0 0 1 5.63 3.297Zm5.198 4.882a2.008 2.008 0 0 0-2.243.407 1.994 1.994 0 0 0-.407 2.243 1.993 1.993 0 0 0 .992.992 2.008 2.008 0 0 0 2.243-.407c.176-.175.31-.374.407-.585a2.008 2.008 0 0 0-.407-2.243 1.993 1.993 0 0 0-.585-.407Z" clip-rule="evenodd" fill-rule="evenodd" />`,
    rocket: `<path d="M2 3.5A1.5 1.5 0 0 1 3.5 2h9A1.5 1.5 0 0 1 14 3.5v11.75A2.75 2.75 0 0 0 16.75 18h-12A2.75 2.75 0 0 1 2 15.25V3.5Zm3.75 7a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5Zm0 3a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5ZM5 5.75A.75.75 0 0 1 5.75 5h4.5a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-.75.75h-4.5A.75.75 0 0 1 5 8.25v-2.5Z" clip-rule="evenodd" fill-rule="evenodd" /><path d="M16.5 6.5h-1v8.75a1.25 1.25 0 1 0 2.5 0V8a1.5 1.5 0 0 0-1.5-1.5Z" />`
  };
  return icons[iconName] || icons.phone;
};
---

<div class="relative isolate overflow-hidden bg-white py-24 sm:py-32">
  <img src="https://images.unsplash.com/photo-1521737604893-d14cc237f11d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&crop=focalpoint&fp-y=.8&w=2830&h=1500&q=80&blend=111827&sat=-100&exp=15&blend-mode=screen" alt="" class="absolute inset-0 -z-10 size-full object-cover object-right opacity-10 md:object-center" />
  
  <div class="hidden sm:absolute sm:-top-10 sm:right-1/2 sm:-z-10 sm:mr-10 sm:block sm:transform-gpu sm:blur-3xl">
    <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)" style={`background: linear-gradient(to top right, ${theme.primary}40, #776fff40);`} class="aspect-1097/845 w-274.25 opacity-15"></div>
  </div>
  
  <div class="absolute -top-52 left-1/2 -z-10 -translate-x-1/2 transform-gpu blur-3xl sm:-top-112 sm:ml-16 sm:translate-x-0">
    <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)" style={`background: linear-gradient(to top right, ${theme.primary}40, #776fff40);`} class="aspect-1097/845 w-274.25 opacity-15"></div>
  </div>

  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <!-- En-tête de section -->
    <div class=" lg:mx-0 text-center mb-16">
      <h2 class="font-semibold text-base uppercase tracking-widest mb-3" >
        {how_it_works.section.title} {cityData.hero_title}
      </h2>
      <h3 class="text-4xl font-semibold tracking-tight sm:text-5xl lg:text-6xl">
        {how_it_works.section.main_title}
      </h3>
    </div>

    <!-- Grille des étapes -->
    <div class="mx-auto mt-16 grid max-w-6xl grid-cols-1 gap-6 sm:mt-20 lg:grid-cols-3 lg:gap-8">
      {how_it_works.steps.map((step, index) => (
        <div class={`group relative overflow-hidden grid justify-between rounded-2xl p-8 transition-all duration-300 hover:shadow-xl ${index === 1 ? 'text-white' : 'bg-white text-gray-900'} ${index === 1 ? `bg-primary` : ''}`} >
          <!-- Numéro de l'étape -->
          <div class="mb-6">
            <span class={`text-5xl font-bold ${index === 1 ? 'text-white/80' : 'text-gray-300'}`}>
              {step.number}
            </span>
          </div>
          
          <!-- Titre -->
          <h3 class={`text-2xl font-bold mb-4 ${index === 1 ? 'text-white' : ''}`} style={index === 1 ? '' : `color: ${theme.title}`}>
            {step.title}
          </h3>
          
          <!-- Description -->
          <p class={`text-base leading-relaxed mb-8 ${index === 1 ? 'text-white/90' : ''}`} style={index === 1 ? '' : `color: ${theme.text}`}>
            {step.description}
          </p>
          
          <!-- CTA -->
          <div>
            <Button
            variant="secondary"
            size="xs"
            icon="arrow_right"
            iconPosition="right"
            modal
            class={`  ${
              index === 1 
                ? 'text-white hover:text-white/80' 
                : 'hover:opacity-80'
            }`}
            
          >
            {step.cta}
            
          </Button>
          
          </div>
          
       
        </div>
      ))}
    </div>
  </div>
</div>